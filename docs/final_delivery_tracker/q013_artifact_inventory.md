# Q-013 - Artifact Usage Inventory and Classification

**Ticket:** Q-013 `[MOB]`
**Status:** Complete
**Date:** 2026-02-21
**Scope:** `research_and_dev/iqrah-knowledge-graph2/` large binary artifacts

---

## Classification Key

| Class | Definition |
|-------|-----------|
| `runtime-required` | Must be present on the device at runtime for the app to function. |
| `r&d-generated` | Output of a build or research script; can be regenerated from source data and scripts. |
| `fixture` | Test/development data used only during testing or local development; not shipped. |
| `release-asset` | Packaged and distributed as part of a production release (may overlap with runtime-required). |

---

## Artifact Registry

### 1. `research_and_dev/iqrah-knowledge-graph2/content.db`

| Field | Value |
|-------|-------|
| **Size** | ~36 MB |
| **Format** | SQLite database |
| **Classification** | `r&d-generated` |
| **Git-tracked** | Yes |

**Description:** The canonical content database generated by the Python knowledge graph pipeline (`iqrah build all --preset full`). Contains all 114 chapters, 6,236 verses, 77,000+ word instances, translations, transliterations, morphology, lemmas, and roots.

**How it is produced:** Running the Python CLI in `research_and_dev/iqrah-knowledge-graph2/`:
```bash
iqrah build content-db \
  -o content.db \
  --morphology data/quran-morphology-v0.5.csv
```

**Runtime role:** The concept of `content.db` is **runtime-required** — the Rust app and CLI require a `content.db` at `data/content.db` (or `$CONTENT_DB_PATH`) to function. However, _this specific file at `research_and_dev/iqrah-knowledge-graph2/content.db`_ is the **R&D source copy**, not the production artifact. The production artifact lives at the app's data directory or is distributed as a release asset. The R&D copy is used by developers to inspect, verify, and re-run extraction scripts.

**Regenerability:** Fully regenerable from `data/quran-morphology-v0.5.csv` and offline Quran data using the Python pipeline. Build time: ~1–2 minutes.

**Justification for keeping tracked:** Required as a development reference for inspecting data quality and schema. Note: `extract_migration_data.py` takes a **GraphML file** as input (not this SQLite DB), and `score_and_extract.py` is referenced in docs but does not exist in the current repo. The primary value of keeping this file tracked is as a stable snapshot of the content data for manual inspection and ad-hoc queries during development.

**Follow-up:** Q-014 will add `.gitignore` rules to untrack this file after confirming the extraction pipeline does not require it to be in the repo.

---

### 2. `research_and_dev/iqrah-knowledge-graph2/content-fixed.db`

| Field | Value |
|-------|-------|
| **Size** | ~36 MB |
| **Format** | SQLite database |
| **Classification** | `r&d-generated` |
| **Git-tracked** | Yes |

**Description:** A corrected/patched variant of `content.db`. Created during iterative data quality work (schema refactoring or data migration runs). The "fixed" suffix indicates a post-hoc correction was applied to the original content.db output.

**How it is produced:** Likely produced by running a migration or repair script (e.g. `extract_migration_data.py`, `generated_migration.sql`) against `content.db`, or by running a fresh build after a schema fix. No script currently in the repo explicitly generates a file named `content-fixed.db` — it was saved manually as a reference copy.

**Runtime role:** None. No Rust test, CLI command, or production code path references `content-fixed.db` by name.

**Regenerability:** Can be regenerated by rerunning the build with the corrected schema. Keeping it is low-value once the pipeline is stable.

**Justification for keeping tracked:** Must not be untracked until Q-014 is complete per Q-013 acceptance criteria.

**Follow-up:** Safe to untrack in Q-014. Recommend deletion after Q-014 is confirmed.

---

### 3. `research_and_dev/iqrah-knowledge-graph2/test-30-content.db`

| Field | Value |
|-------|-------|
| **Size** | ~36 MB |
| **Format** | SQLite database |
| **Classification** | `fixture` |
| **Git-tracked** | Yes |

**Description:** A content database scoped to the first 30 verses (Al-Fatihah 1–7 + Al-Baqarah 1–23). Generated using the `test-30-verses` preset for scheduler v2 development and testing. This was the primary test fixture during the C-001/C-002 test suite development phase.

**How it is produced:**
```bash
iqrah build content-db \
  -o test-30-content.db \
  --morphology data/quran-morphology-v0.5.csv \
  --chapters "1,2:1-23"
```
Or via the full `test-30-verses.yaml` preset.

**Runtime role:** None in production. Used only during local development of the scheduler v2 when a small, fast-loading content DB was needed.

**Regenerability:** Fully regenerable in < 1 minute.

**Justification for keeping tracked:** Must not be untracked until Q-014 is complete per Q-013 acceptance criteria.

**Follow-up:** Candidate for untracking in Q-014. After Q-014, this should either live in CI cache or be regenerated on demand by test setup scripts.

---

### 4. `research_and_dev/iqrah-knowledge-graph2/knowledge-graph.cbor.zst`

| Field | Value |
|-------|-------|
| **Size** | ~12 MB |
| **Format** | Compressed CBOR (zstandard) |
| **Classification** | `r&d-generated` (will become `release-asset` when packaged) |
| **Git-tracked** | Yes |

**Description:** The main knowledge graph output: structure-only CBOR containing all nodes (chapters, verses, word instances, lemmas, roots), edges (memorization, translation, grammar), and PageRank scores (foundational + influence). Produced by the `full` preset run of the Python pipeline.

**How it is produced:**
```bash
iqrah build knowledge-graph \
  --from-scratch \
  --morphology data/quran-morphology-v0.5.csv \
  --preset full \
  -o knowledge-graph.cbor.zst
```

**Runtime role:** Intended to be consumed by the Rust `iqrah-core` crate via `cbor_import.rs`, but **import persistence is not yet implemented** — the batch insert calls (`insert_nodes_batch`, `insert_edges_batch`) are commented out with a TODO in `cbor_import.rs:218-220`. The current code parses the CBOR but discards all data after parsing. The runtime instead relies on the pre-populated `content.db` via SQL migrations. This file is therefore a **reference artifact** for future implementation of the CBOR bootstrap path, not an operationally active input. In the intended future state, it will be distributed as a release asset downloaded during app bootstrap.

**Regenerability:** Regenerable from source data. Full build time: ~8–13 minutes (full preset). The output is deterministic given the same source data and pipeline version.

**Justification for keeping tracked:** Valuable as a reference build for verifying the Python pipeline output and for development of the C-011 CBOR import persistence work. Not currently wired into any automated test or production path.

**Follow-up:** Q-014 decision point: either untrack and regenerate in CI, or promote to an explicit versioned artifact path outside `research_and_dev/`. Recommend untracking in Q-014 and adding to release packaging pipeline.

---

### 5. `research_and_dev/iqrah-knowledge-graph2/test_output/baseline_graph.cbor.zst`

| Field | Value |
|-------|-------|
| **Size** | ~945 KB |
| **Format** | Compressed CBOR |
| **Classification** | `fixture` |
| **Git-tracked** | Yes |

**Description:** The reference graph used by the node ID stability validation system (`validate_stability.py`, `pipeline_validation.py`). On the first build, the output graph is saved as the baseline. On subsequent builds, the new graph is validated against this baseline — all node IDs in the baseline must exist in the new graph.

**How it is produced:** Automatically by the Python build pipeline on first run, or manually:
```bash
python validate_stability.py old_graph.cbor.zst new_graph.cbor.zst
```

**Runtime role:** None in production. Used only by the Python knowledge graph build validation pipeline.

**Regenerability:** Not freely regenerable — it represents the *committed* node ID baseline for the current schema version. Changing it requires a deliberate major-version bump and migration mapping document. It serves a regression-guard role analogous to a snapshot test.

**Justification for keeping tracked:** This is a legitimate regression fixture and should remain tracked. It is not a generated artifact in the free-regeneration sense — it is a committed contract for node ID stability.

**Follow-up:** Keep tracked. This should be explicitly excluded from any Q-014 untracking rules.

---

### 6. `research_and_dev/iqrah-knowledge-graph2/test_output/graph1.cbor.zst`, `graph2.cbor.zst`, `graph3.cbor.zst`

| Field | Value |
|-------|-------|
| **Size** | ~616 KB each (graph1, graph2); ~945 KB (graph3) |
| **Format** | Compressed CBOR |
| **Classification** | `r&d-generated` |
| **Git-tracked** | Yes |

**Description:** Test run outputs from the pipeline stability validation test suite (`tests/test_pipeline_validation.py`). Three graphs were built and validated against each other to verify the validation system itself is correct. These are side-effects of running the test suite with output written to the directory.

**How they are produced:** Running the Python test suite:
```bash
cd research_and_dev/iqrah-knowledge-graph2
pytest tests/test_pipeline_validation.py -v
```

**Runtime role:** None. Neither the Rust codebase nor any production flow references these files.

**Regenerability:** Freely regenerable by running the test suite.

**Justification for keeping tracked:** No strong justification. These are test run outputs that polluted the working directory.

**Follow-up:** Strong candidates for untracking in Q-014. The `test_output/` directory should be covered by a `.gitignore` rule (except for `baseline_graph.cbor.zst` which is a fixture — see item 5 above).

---

## Summary Table

| Artifact | Size | Class | Git-tracked | Runtime | Ship in Release | Safe to Untrack (Q-014) |
|----------|------|-------|-------------|---------|-----------------|-------------------------|
| `content.db` | 36 MB | `r&d-generated` | Yes | No (R&D copy) | No (re-built for release) | Yes (after pipeline adapts) |
| `content-fixed.db` | 36 MB | `r&d-generated` | Yes | No | No | Yes — recommend deletion |
| `test-30-content.db` | 36 MB | `fixture` | Yes | No | No | Yes — regenerable on demand |
| `knowledge-graph.cbor.zst` | 12 MB | `r&d-generated` → `release-asset` | Yes | No (import not yet persistent — C-011) | Yes (future) | Yes — after release pipeline |
| `test_output/baseline_graph.cbor.zst` | 945 KB | `fixture` | Yes | No | No | **No — keep as regression baseline** |
| `test_output/graph1.cbor.zst` | 616 KB | `r&d-generated` | Yes | No | No | Yes — test run output |
| `test_output/graph2.cbor.zst` | 616 KB | `r&d-generated` | Yes | No | No | Yes — test run output |
| `test_output/graph3.cbor.zst` | 945 KB | `r&d-generated` | Yes | No | No | Yes — test run output |

---

### Additional Tracked Artifact (Outside Q-013 Explicit Scope)

**`research_and_dev/iqrah-knowledge-graph2/generated_migration.sql`** — A generated SQL migration script produced by `score_and_extract.py` / `extract_migration_data.py`. This file seeds `node_metadata` and `node_goals` into the Rust storage layer. It is tracked in git because it is consumed by the Rust migration system (`rust/crates/iqrah-storage/migrations_content/`). Classification: **r&d-generated** (but committed intentionally as a migration artifact). Not in scope for Q-014 untracking — it is a legitimate committed migration.

---

## Acceptance Verification

Per Q-013 acceptance criteria:

1. ✅ Written inventory committed in docs (this file).
2. ✅ No deletion or untracking has occurred — all artifacts remain tracked until Q-014 is complete.

---

## Linked Tickets

- **Q-014** — Safe git-hygiene cleanup: acts on the "Safe to Untrack" column above. Must not begin before this inventory is complete.
- **D-012 / D-013** — Release packaging pipeline: determines the final home of `knowledge-graph.cbor.zst` as a release asset.
